<?php

/**
 * Test class for Core_Model_User_Service.
 * Generated by PHPUnit on 2011-06-22 at 18:34:04.
 */
class Core_Model_Installer {

    public static $groupOwner;
    public static $groupGuest;
    public static $groupMember;
    public static $groupAdmin;
    public static $groupContentAdmin;
    public static $userGuest;
    public static $userMember;
    public static $userSpecialMember;
    public static $userAdmin;
    public static $userSuperAdmin;

    public static function install() {
        //create groups
        $group_acls = array();
        $gService = new Core_Model_Group_Service();
            
        $owner = array(
            'parent' => null,
            'type' => 0,
            'title' => 'Owner',
            'description' => 'Privileges given to the creator of a content item',
            'visible' => false,
            'user_count' => 0,
            'settings' => array());

        $result = $gService->create($owner);
        self::$groupOwner = $result->id;
        
        $group_acls[] = array('group' => $result->id, 'module' => null, 'controller' => null, 'action' => 'edit', 'permission' => 1);
        $group_acls[] = array('group' => $result->id, 'module' => null, 'controller' => null, 'action' => 'delete', 'permission' => 1);

        $guest = array(
            'parent' => null,
            'type' => 1,
            'title' => 'Guest',
            'description' => 'Users that have not been Authenticated',
            'visible' => false,
            'user_count' => 0,
            'settings' => array());

        $result = $gService->create($guest);
        self::$groupGuest = $result->id;
        $group_acls = array();
        $group_acls[] = array('group' => $result->id, 'module' => 'core', 'controller' => 'index', 'action' => null, 'permission' => 1);
        $group_acls[] = array('group' => $result->id, 'module' => 'core', 'controller' => 'login', 'action' => null, 'permission' => 1);
        $group_acls[] = array('group' => $result->id, 'module' => 'core', 'controller' => 'index', 'action' => null, 'permission' => 1);
        $group_acls[] = array('group' => $result->id, 'module' => 'core', 'controller' => 'user', 'action' => 'next-steps', 'permission' => 1);

        $member = array(
            'parent' => null,
            'type' => 1,
            'title' => 'Member',
            'description' => 'Authenticated Users',
            'visible' => true);

        $result = $gService->create($member);
        self::$groupMember = $result->id;
        $group_acls[] = array('group' => $result->id, 'module' => 'core', 'controller' => 'user', 'action' => null, 'permission' => 1);

        $contentAdmin = array(
            'parent' => null,
            'type' => 1,
            'title' => 'Admin',
            'description' => 'Admin Site Content',
            'visible' => true);

        $result = $gService->create($contentAdmin);
        self::$groupContentAdmin = $result->id;
        $siteAdmin = array(
            'parent' => null,
            'type' => 1,
            'title' => 'Site Admin',
            'description' => 'Full access to Site',
            'visible' => false);

        $result = $gService->create($siteAdmin);
        self::$groupAdmin = $result->id;
        $group_acls[] = array('group' => $result->id, 'module' => null, 'controller' => null, 'action' => null, 'permission' => 1);

        $agService = new Core_Model_Acl_Group_Service();
        foreach ($group_acls as $acl) {
            $agService->create($acl);
        }


        //create user
        $user_acls = array();


        $uService = new Core_Model_User_Service();

        $guest = array(
            'status' => 1,
            'primary_group' => self::$groupGuest,
            'username' => 'Guest',
            'name' => 'Guest',
            'location' => 'Guest Location',
            'email' => 'guest@mcdportal.com',
            'settings' => array());

        $result = $uService->create($guest);
        self::$userGuest = $result->id;

        $user = array(
            'status' => 1,
            'primary_group' => self::$groupMember,
            'username' => 'TestUser1',
            'name' => 'Test User',
            'location' => 'Random',
            'email' => 'testuser1@mcdportal.com',
            'settings' => array());

        $result = $uService->create($user);
        self::$userMember = $result->id;

        $user = array(
            'status' => 1,
            'primary_group' => self::$groupMember,
            'username' => 'TestUser2',
            'name' => 'Test Special User ',
            'location' => 'Random',
            'email' => 'testuser2@mcdportal.com',
            'settings' => array());

        $result = $uService->create($user);
        self::$userSpecialMember = $result->id;
        
        $user_acls[] = array('user' => $result->id, 'module' => 'core', 'controller' => 'test', 'action' => 'special', 'permission' => 1);

        $admin = array(
            'status' => 1,
            'primary_group' => self::$groupContentAdmin,
            'username' => 'TestAdmin',
            'name' => 'Test User',
            'location' => 'Random',
            'email' => 'testadmin@mcdportal.com',
            'settings' => array());

        $result = $uService->create($admin);
        self::$userAdmin = $result->id;

        $superAdmin = array(
            'status' => 1,
            'primary_group' => self::$groupAdmin,
            'username' => 'TestSuperAdmin',
            'name' => 'Test Super User',
            'location' => 'Random',
            'email' => 'testsuperadmin@mcdportal.com',
            'settings' => array());

        $result = $uService->create($superAdmin);
        self::$userSuperAdmin = $result->id;



        $auService = new Core_Model_Acl_User_Service();
        foreach ($user_acls as $acl) {
            $auService->create($acl);
        }
    }

    public static function uninstall() {
        $gService = new Core_Model_Group_Service();
        $gService->deleteAll();

        $agService = new Core_Model_Acl_Group_Service();
        $agService->deleteAll();

        $ugaService = new Core_Model_Acl_User_Service();
        $agService->deleteAll();

        $uService = new Core_Model_User_Service();
        $uService->deleteAll();

        $umService = new Core_Model_User_Membership_Service();
        $umService->deleteAll();
        
        $authInternal = new Core_Model_Auth_Internal();
        $authInternal->deleteAll();
        
    }

}