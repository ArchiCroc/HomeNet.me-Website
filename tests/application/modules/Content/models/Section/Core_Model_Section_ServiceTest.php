<?php

require_once dirname(__FILE__) . '/../../../../application/models/Section/Service.php';

/**
 * Test class for Core_Model_Section_Service.
 * Generated by PHPUnit on 2011-06-22 at 08:13:54.
 */
class Core_Model_Section_ServiceTest extends PHPUnit_Framework_TestCase {

    /**
     * @var Core_Model_Category_Service
     */
    protected $object;

    /**
     * Sets up the fixture, for example, opens a network connection.
     * This method is called before a test is executed.
     */
    protected function setUp() {
        $this->object = new Core_Model_Section_Service();
    }

    /**
     * Tears down the fixture, for example, closes a network connection.
     * This method is called after a test is executed.
     */
    protected function tearDown() {
      $this->object->deleteAll();
    }

    public function testGetMapper() {

        $this->assertInstanceOf('Core_Model_Section_MapperInterface', $this->object->getMapper());
    }

    /**
     * @todo Implement testSetMapper().
     */
    public function testSetMapper() {
        
        $mapper = new Core_Model_Section_MapperDbTable();
         $this->object->setMapper($mapper);
        
        $this->assertInstanceOf('Core_Model_Section_MapperInterface', $this->object->getMapper());
        $this->assertEquals($mapper, $this->object->getMapper());
        //$this->ass
    }

    private function createValidSection() {
        $section = new Core_Model_Section();
        $section->package = 'test';
        $section->title = 'testTitle';
        $section->url = 'testUrl';
        $section->description = null;
        $section->visible = true;
        $result = $this->object->create($section);

        $this->assertInstanceOf('Core_Model_Section_Interface', $result);
        return $result;
    }
    
    public function testCreateNullPackageSection() {
        $section = new Core_Model_Section();
        $section->package = null;
        $section->title = 'testTitle';
        $section->url = 'testUrl';
        $section->description = null;
        $section->visible = true;
        $result = $this->object->create($section);
        $this->assertInstanceOf('Core_Model_Section_Interface', $result);
    }
    
    public function testCreateInvalidSection() {
       $section = new Core_Model_Section();
        //$section->package = 'test';
        
       // $section->title = 'testTitle';
        $section->url = 'testUrl';
        $section->description = null;
        $section->visible = true;
        $this->setExpectedException('Exception');
        $result = $this->object->create($section);
    } 
    
    public function testDuplicateUrl() {

        $category1 = $this->createValidSection();
        $this->setExpectedException('DuplicateEntryException');
        $category2 = $this->createValidSection();
    }
    
    public function testCreateValidFromObject() {

        $result = $this->createValidSection();

        $this->assertNotNull($result->id);
        $this->assertEquals('test', $result->package);
        $this->assertEquals('testTitle', $result->title);
        $this->assertEquals('testUrl', $result->url);
        $this->assertEquals(null, $result->description);
        $this->assertEquals(true, $result->visible);
        
    }
    
    public function testCreateFromArray() {
   
        $section = array(
        'package' => 'test',
        'title' => 'testTitle',
        'url' => 'testUrl',
        'description' => null,
        'visible' => true);

        $result = $this->object->create($section);

        $this->assertInstanceOf('Core_Model_Section_Interface', $result);

        $this->assertNotNull($result->id);
        $this->assertEquals('test', $result->package);
        $this->assertEquals('testTitle', $result->title);
        $this->assertEquals('testUrl', $result->url);
        $this->assertEquals(null, $result->description);
        $this->assertEquals(true, $result->visible);
    }

    public function testCreateException() {
        $this->setExpectedException('InvalidArgumentException');

        $badObject = new StdClass();
        $create = $this->object->create($badObject);
    }

    public function testGetObjectById() {

        //setup
        $section = $this->createValidSection();

        //test getObject
        $result = $this->object->getObjectById($section->id);
        
        $this->assertInstanceOf('Core_Model_Section_Interface', $result);

        $this->assertNotNull($result->id);
        $this->assertEquals('test', $result->package);
        $this->assertEquals('testTitle', $result->title);
        $this->assertEquals('testUrl', $result->url);
        $this->assertEquals(null, $result->description);
        $this->assertEquals(true, $result->visible);
    }

    public function testUpdateFromObject() {

        //setup
        $section = $this->createValidSection();
        $this->assertInstanceOf('Core_Model_Section_Interface', $section);

        //update values
       $section->package = null;
       $section->title = 'testTitle2';
       $section->url = 'testUrl2';
      $section->description = 'testDescription2';
      $section->visible = false;

        $result = $this->object->update($section);

        $this->assertInstanceOf('Core_Model_Section_Interface', $result);

        $this->assertEquals($section->id, $result->id);
        $this->assertEquals(null, $result->package);
        $this->assertEquals('testTitle2', $result->title);
        $this->assertEquals('testUrl2', $result->url);
        $this->assertEquals('testDescription2', $result->description);
        $this->assertEquals(false, $result->visible);
    }
    
    public function testUpdateFromArray() {

        //setup
        $section = $this->createValidSection();

        $array = $section->toArray();
        
        //update values
        $array['package'] = null;
        $array['title'] = 'testTitle2';
        $array['url'] = 'testUrl2';
        $array['description'] = 'testDescription2';
        $array['visible'] = false;
        
        $result = $this->object->update($array);

        $this->assertInstanceOf('Core_Model_Section_Interface', $result);

        $this->assertEquals($section->id, $result->id);
        $this->assertEquals(null, $result->package);
        $this->assertEquals('testTitle2', $result->title);
        $this->assertEquals('testUrl2', $result->url);
        $this->assertEquals('testDescription2', $result->description);
        $this->assertEquals(false, $result->visible);
    }
    

    public function testUpdateException() {
        $this->setExpectedException('InvalidArgumentException');

        $badObject = new StdClass();
        $create = $this->object->update($badObject);
    }

    public function testDeleteObject() {

        //setup
        $section = $this->createValidSection();

        //test delete
        $this->object->delete($section);

        //verify that it was deleted
        $this->setExpectedException('NotFoundException');
        $result = $this->object->getObjectById($section->id);
    }

    public function testDeleteId() {

        //setup
        $section = $this->createValidSection();
       // $this->fail("id: ".$section->id);
        $this->object->delete((int)$section->id);
        
        $this->setExpectedException('NotFoundException');
        $result = $this->object->getObjectById($section->id); 
    }
    
    public function testDeleteArray() {

        //setup
        $section = $this->createValidSection();
       // $this->fail("id: ".$section->id);
        $this->object->delete($section->toArray());
        
        $this->setExpectedException('NotFoundException');
        $result = $this->object->getObjectById($section->id); 
    }

    public function testDeleteException() {
        $this->setExpectedException('InvalidArgumentException');

        $badObject = new StdClass();
        $create = $this->object->delete($badObject);
    }

    public function testDeleteAll() {
//        $this->object->deleteAll();
    }

}

?>
